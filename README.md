# Asm. Транслятор и модель

- Маликов Александр Максимович
- `asm | stack | harv | hw | instr | struct | trap -> stream | mem | pstr | prob1 | cache`
- Базовый вариант. Без усложнений.


## Язык программирования

``` ebnf
program         ::=     { statement }

statement       ::=     section       [ comment ] "\n"
                      | declaration   [ comment ] "\n"
                      | label         [ comment ] "\n"
                      | instruction   [ comment ] "\n"
                      |               [ comment ] "\n"

section         ::=     "." section_name
section_name    ::=     "data" | "code"

declaration     ::=     variable_name type value
variable_name   ::=     <any of "a-z A-Z _"> { <any of "a-z A-Z 0-9 _"> }
type            ::=     NUMBER | STRING
value           ::=     number | string
number          ::=     { <any of "0-9"> }
string          ::=     "\"" { <any symbols except "\""> } "\""
                      | "\'" { <any symbols except "\'"> } "\'"

label           ::=     label_name ":"
label_name      ::=     <any of "a-z A-Z _"> { <any of "a-z A-Z 0-9 _"> }

instruction     ::=     opcode_0
                      | opcode_1 operand
                      | opcode_2 label_name
              
opcode          ::=     "POP" 
                      | "DUP" 
                      | "INC" 
                      | "DEC" 
                      | "SWAP" 
                      | "ADD" 
                      | "SUB" 
                      | "MUL" 
                      | "DIV" 
                      | "COMPARE" 
                      | "NOP"
                      | "HLT"
                      | "PUSH" 
                      | "PUSH_VAL"
                      | "JMP" 
                      | "JEQ" 
                      | "JNE" 
                      | "PRINT" 
                      | "PRINT_VAL" 
                      | "PRINT_BY_INDEX" 
                      | "SAVE" 
                      | "LOAD" 

arg             ::=     value | variable_name

comment         ::=     ";" <any symbols except "\n">
```

Код выполняется последовательно. Операции:

Система команд:

- `PUSH value`          -- положить value на вершину стека
- `PUSH_VAL name`           -- положить адрес переменной на вершину стека
- `POP`                           -- сместить указатель вершины стека на одну ячейку влево
- `DUP`                     -- дублирование значения на вершине стека
- `INC`                 -- увеличить значение на вершине стека на 1
- `DEC`    -- уменьшить значение на вершине стека на 1
- `JMP`                          -- безусловный переход
- `JEQ`        -- условный переход, где сравнение `a == b` истинно 
- `JNE`  -- условный переход, где сравнение `a != b` истинно
- `SWAP`             -- поменять местами два верхних значения на вершине стека
- `ADD`             -- сложить два верхних значения на вершине стека
- `SUB`             -- вычесть из второго верхнего значения на стеке первое
- `MUL`             -- умножить два верхних значения на вершине стека
- `DIV`             -- разделить второе значение на вершине стека на первое
- `COMPARE`           -- сравнить два значения на вершине стека
- `LOAD addr`            -- по переданному адресу, загрузить на вершину стека значение из памяти
- `SAVE`            -- записать вершину стека в память по адресу (значению) второго значения в стеке
- `PRINT`             -- записать вершину стека как литерал на устройство вывода 
- `PRINT_VAL`            -- записать вершину стека в устройство вывода
- `PRINT_BY_INDEX`             -- записать значение из памяти в устройство вывода, по адресу (значению) вершины стека
- `NOP`             -- ничего не выполнять
- `HLT`     -- завершить выполнение программы


## Тестирование


```text
| ФИО                          | алг        | LoC  | code байт | code инстр. | инстр.    | такт.    | вариант |
| Маликов Александр Максимович | hello      | 18   | -         | 12          | 94        | 318      | -       |
| Маликов Александр Максимович | cat        | 19   | -         | 14          | 143       | 427      | -       |
| Маликов Александр Максимович | hello_user | 110  | -         | 77          | 450       | 1461     | -       |
| Маликов Александр Максимович | prob1      | 97   | -         | 82          | 6617      | 24632    | -       |
```